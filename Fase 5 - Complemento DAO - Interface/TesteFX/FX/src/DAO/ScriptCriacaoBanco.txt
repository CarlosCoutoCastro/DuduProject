


create table objetos (
    codigo_objeto serial primary key,
    quantidade_exemplares int,
    valor_aluguel float
);


create table tb_livros (
	titulo varchar(40) primary key,
	codigo_objeto int,
	genero varchar(40),
	autor varchar(20),
	data_de_lancamento Date,
	quantidade_pagina int,
	foreign key(codigo_objeto) references objetos(codigo_objeto)
);

create table tb_discos (
	titulo varchar(40) primary key,
	codigo_objeto int,
	nome_banda varchar(30),
	estilo varchar(30),
	foreign key(codigo_objeto) references objetos(codigo_objeto)
);

create table tb_clientes(
	codigo_cliente serial unique,
	cpf varchar(30) unique,
	nome varchar(40) not null,
	endereco varchar(40),
	primary key (codigo_cliente,cpf)
);

create table tb_alugueis (
	codigo_aluguel serial primary key,
	cpf_cliente varchar(30) not null,
	codigo_objeto int not null,
	data_aquisicao Date not null,
	data_devolucao Date not null,
	foreign key(cpf_cliente) references tb_clientes(cpf),
	foreign key(codigo_objeto) references objetos(codigo_objeto)
);

create table tb_funcionarios (
	codigo_funcionario int ,
	login varchar(30) primary key,
	senha varchar(30) not null,
	funcao varchar(20) not null
);

CREATE VIEW view_vendas AS
SELECT tb_livros.titulo AS titulo, objetos.Quantidade_exemplares, objetos.Valor_aluguel
FROM tb_livros
INNER JOIN objetos ON tb_livros.codigo_objeto = objetos.codigo_objeto
UNION
SELECT tb_discos.titulo, objetos.Quantidade_exemplares, objetos.Valor_aluguel
FROM tb_discos
INNER JOIN objetos ON tb_discos.codigo_objeto = objetos.codigo_objeto;

CREATE VIEW view_alugueis AS
SELECT
    c.nome AS nome,
    COALESCE(l.titulo, d.titulo) AS titulo,
    o.valor_aluguel AS valor_aluguel,
    a.data_aquisicao AS data_aquisicao,
    a.data_devolucao AS data_devolucao
FROM tb_alugueis AS a
JOIN tb_clientes AS c ON a.cpf_cliente = c.cpf
JOIN objetos AS o ON a.codigo_objeto = o.codigo_objeto
LEFT JOIN tb_livros AS l ON a.codigo_objeto = l.codigo_objeto
LEFT JOIN tb_discos AS d ON a.codigo_objeto = d.codigo_objeto;